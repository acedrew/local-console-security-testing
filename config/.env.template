# ============================================================================
# Environment Configuration Template for PKI System
# ============================================================================
# IMPORTANT: Copy this file to .env and update values
# NEVER commit .env file to version control
# ============================================================================

# ----------------------------------------------------------------------------
# General Settings
# ----------------------------------------------------------------------------
ENVIRONMENT=production  # Options: development, staging, production
TZ=UTC
LOG_LEVEL=INFO  # Options: DEBUG, INFO, WARNING, ERROR, CRITICAL

# ----------------------------------------------------------------------------
# PKI Service Configuration
# ----------------------------------------------------------------------------

# Certificate Authority Settings
CA_COMMON_NAME=Local Console PKI Root CA
CA_ORGANIZATION=Example Organization
CA_ORGANIZATIONAL_UNIT=Security Team
CA_COUNTRY=US
CA_STATE=California
CA_LOCALITY=San Francisco

# Certificate Lifetime (in seconds)
# Recommended: 900 (15 minutes) for production
# Development: 1800 (30 minutes)
PKI_CERT_LIFETIME=900

# Cryptographic Algorithm
# Options: RSA, ECDSA
# Recommended: ECDSA (faster, smaller keys)
PKI_CERT_ALGORITHM=ECDSA

# Key Size
# For RSA: 2048, 3072, 4096 (recommended: 4096)
# For ECDSA: 256, 384, 521 (recommended: 384)
PKI_CERT_KEY_SIZE=384

# Certificate Revocation
PKI_ENABLE_OCSP=true
PKI_ENABLE_CRL=true
PKI_CRL_UPDATE_INTERVAL=3600  # Seconds

# Certificate Validation
PKI_STRICT_VALIDATION=true
PKI_CHECK_REVOCATION=true
PKI_VERIFY_HOSTNAME=true

# ----------------------------------------------------------------------------
# MQTT Broker Configuration
# ----------------------------------------------------------------------------

# MQTT Connection
MQTT_HOST=mqtt-broker
MQTT_PORT=8883
MQTT_USE_TLS=true

# MQTT Authentication
MQTT_USERNAME=pki-service
MQTT_PASSWORD_FILE=/run/secrets/mqtt_credentials

# MQTT Verification
MQTT_VERIFY_ENABLED=true
MQTT_VERIFY_TIMEOUT=5  # Seconds
MQTT_DEVICE_TOPIC=devices/+/status
MQTT_VERIFICATION_TOPIC=devices/+/verify

# MQTT Quality of Service
MQTT_QOS=1  # 0=at most once, 1=at least once, 2=exactly once

# ----------------------------------------------------------------------------
# Network Configuration
# ----------------------------------------------------------------------------

# PKI Service Binding
PKI_BIND_HOST=0.0.0.0
PKI_BIND_PORT=8443

# TLS Configuration
PKI_TLS_VERSION=1.3  # Minimum TLS version
PKI_TLS_CIPHERS=TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256:TLS_AES_128_GCM_SHA256

# Client Authentication
PKI_REQUIRE_CLIENT_CERT=false  # Set true for mutual TLS

# ----------------------------------------------------------------------------
# Storage Paths
# ----------------------------------------------------------------------------

# Data Directories
PKI_DATA_DIR=./data/pki
PKI_CERT_DIR=./data/certificates
PKI_LOG_DIR=./logs/pki

MQTT_CERT_DIR=./data/mqtt-certs
MQTT_DATA_DIR=./data/mqtt
MQTT_LOG_DIR=./logs/mqtt

CONFIG_DIR=./config
SECRETS_DIR=./secrets

# ----------------------------------------------------------------------------
# Database Configuration
# ----------------------------------------------------------------------------

# Certificate Database
# Options: sqlite, postgresql, mysql
DB_TYPE=sqlite
DB_PATH=./data/pki/certificates.db

# For PostgreSQL (if using)
# DB_HOST=localhost
# DB_PORT=5432
# DB_NAME=pki_certificates
# DB_USER=pki_service
# DB_PASSWORD_FILE=/run/secrets/db_password
# DB_SSL_MODE=require

# ----------------------------------------------------------------------------
# Security Settings
# ----------------------------------------------------------------------------

# API Security
API_RATE_LIMIT=100  # Requests per minute
API_MAX_REQUEST_SIZE=10485760  # 10MB in bytes
API_ENABLE_CORS=false

# Authentication
AUTH_TOKEN_EXPIRY=3600  # Seconds
AUTH_REQUIRE_MFA=false

# Audit Logging
AUDIT_LOG_ENABLED=true
AUDIT_LOG_PATH=./logs/audit.log
AUDIT_LOG_REMOTE=false
# AUDIT_LOG_REMOTE_HOST=syslog.example.com
# AUDIT_LOG_REMOTE_PORT=514

# Monitoring
MONITORING_ENABLED=true
MONITORING_PORT=9090  # Prometheus metrics
MONITORING_ENDPOINT=/metrics

# ----------------------------------------------------------------------------
# Docker Resource Limits
# ----------------------------------------------------------------------------

# PKI Service Resources
PKI_CPU_LIMIT=2.0
PKI_MEMORY_LIMIT=1G
PKI_CPU_RESERVATION=0.5
PKI_MEMORY_RESERVATION=256M

# MQTT Broker Resources
MQTT_CPU_LIMIT=1.0
MQTT_MEMORY_LIMIT=512M
MQTT_CPU_RESERVATION=0.25
MQTT_MEMORY_RESERVATION=128M

# Config Service Resources
CONFIG_CPU_LIMIT=0.5
CONFIG_MEMORY_LIMIT=256M
CONFIG_CPU_RESERVATION=0.1
CONFIG_MEMORY_RESERVATION=64M

# ----------------------------------------------------------------------------
# Backup Configuration
# ----------------------------------------------------------------------------

BACKUP_ENABLED=true
BACKUP_SCHEDULE=0 */6 * * *  # Every 6 hours (cron format)
BACKUP_RETENTION_DAYS=30
BACKUP_DESTINATION=./backups
# BACKUP_REMOTE_ENABLED=false
# BACKUP_REMOTE_TYPE=s3
# BACKUP_REMOTE_BUCKET=pki-backups
# BACKUP_REMOTE_REGION=us-west-2

# ----------------------------------------------------------------------------
# Feature Flags
# ----------------------------------------------------------------------------

# Experimental Features
FEATURE_AUTO_RENEWAL=true
FEATURE_CERTIFICATE_TEMPLATES=true
FEATURE_MULTI_CA=false
FEATURE_HSM_INTEGRATION=false

# Developer Features (disable in production)
FEATURE_DEBUG_MODE=false
FEATURE_VERBOSE_LOGGING=false
FEATURE_SWAGGER_UI=false

# ----------------------------------------------------------------------------
# Alerting Configuration
# ----------------------------------------------------------------------------

ALERTS_ENABLED=true
ALERT_EMAIL_ENABLED=false
# ALERT_EMAIL_SMTP_HOST=smtp.example.com
# ALERT_EMAIL_SMTP_PORT=587
# ALERT_EMAIL_FROM=pki-alerts@example.com
# ALERT_EMAIL_TO=security-team@example.com

ALERT_SLACK_ENABLED=false
# ALERT_SLACK_WEBHOOK_URL=https://hooks.slack.com/services/YOUR/WEBHOOK/URL

ALERT_PAGERDUTY_ENABLED=false
# ALERT_PAGERDUTY_INTEGRATION_KEY=your_integration_key

# Alert Thresholds
ALERT_CERT_ISSUANCE_SPIKE_THRESHOLD=200  # Percent of baseline
ALERT_AUTH_FAILURE_THRESHOLD=10  # Failures within 5 minutes
ALERT_CPU_THRESHOLD=80  # Percent
ALERT_MEMORY_THRESHOLD=80  # Percent
ALERT_DISK_THRESHOLD=90  # Percent

# ----------------------------------------------------------------------------
# Development/Testing Settings (Disable in Production!)
# ----------------------------------------------------------------------------

# Allow insecure connections (NEVER enable in production)
DEV_ALLOW_INSECURE=false

# Skip certificate validation (NEVER enable in production)
DEV_SKIP_CERT_VALIDATION=false

# Generate test certificates on startup
DEV_GENERATE_TEST_CERTS=false

# Mock MQTT broker (for testing without real broker)
DEV_MOCK_MQTT=false

# ============================================================================
# SECURITY CHECKLIST
# ============================================================================
# Before deploying to production, verify:
#
# ✅ All passwords and secrets are in Docker secrets, not environment variables
# ✅ TLS 1.3 is enforced (PKI_TLS_VERSION=1.3)
# ✅ Certificate lifetime is appropriate (PKI_CERT_LIFETIME=900 or less)
# ✅ MQTT verification is enabled (MQTT_VERIFY_ENABLED=true)
# ✅ Audit logging is enabled (AUDIT_LOG_ENABLED=true)
# ✅ Monitoring is enabled (MONITORING_ENABLED=true)
# ✅ All development features are disabled (DEV_*=false)
# ✅ Strong cryptographic algorithms (ECDSA P-384 or RSA 4096)
# ✅ Rate limiting is enabled (API_RATE_LIMIT set appropriately)
# ✅ Backups are configured (BACKUP_ENABLED=true)
# ✅ Alerts are configured for critical events
# ✅ .env file is in .gitignore
# ✅ File permissions on .env are 0600 (owner read/write only)
#
# Generate .env file permissions:
# chmod 600 .env
# chown 1000:1000 .env
# ============================================================================
